<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Podcast Library</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/web/favicon.svg">
    <link rel="apple-touch-icon" href="/web/favicon.svg">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://podcastlibrary.org/">
    <meta property="og:title" content="Podcast Library">
    <meta property="og:description" content="Discover and listen to thousands of podcasts, audiobooks, and audio content. Browse by author, category, or search for your favorite shows.">
    <meta property="og:image" content="https://podcastlibrary.org/web/og-image.svg">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://podcastlibrary.org/">
    <meta name="twitter:title" content="Podcast Library">
    <meta name="twitter:description" content="Discover and listen to thousands of podcasts, audiobooks, and audio content.">
    <meta name="twitter:image" content="https://podcastlibrary.org/web/og-image.svg">
    
    <!-- Additional Meta -->
    <meta name="description" content="Discover and listen to thousands of podcasts, audiobooks, and audio content. Browse by author, category, or search for your favorite shows.">
    <meta name="robots" content="index, follow">
    
    <!-- Audio Session Configuration for iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-9CDHCMHT8J"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-9CDHCMHT8J', {
            anonymize_ip: true,
            allow_google_signals: false,
            allow_ad_personalization_signals: false,
            transport_type: 'beacon',
        });
    </script>
    
    <link rel="stylesheet" href="/web/styles.css">
</head>
<body class="dark-mode">
    <!-- Sidebar -->
    <div id="sidebar" class="sidebar">
        <div class="sidebar-header">
            <h2>Menu</h2>
            <div style="display: flex; gap: 8px; align-items: center;">
                <button class="btn-help-nav" onclick="showNavigationHelp()" title="Navigation Help">?</button>
                <button class="btn-close-sidebar" onclick="toggleSidebar()">‚úï</button>
            </div>
        </div>
        
        <div class="sidebar-section">
            <a href="/" class="sidebar-item" id="sidebar-item-library">
                <span class="sidebar-item-icon">üìö</span>
                <span class="sidebar-item-title">Library</span>
            </a>
            <a href="/recent" class="sidebar-item" id="sidebar-item-recent">
                <span class="sidebar-item-icon">üïê</span>
                <span class="sidebar-item-title">Recently Listened To</span>
                <span id="sidebar-recent-count" class="sidebar-item-count">0</span>
            </a>
            <a href="/favorites" class="sidebar-item" id="sidebar-item-favorites">
                <span class="sidebar-item-icon">‚≠ê</span>
                <span class="sidebar-item-title">Favorites</span>
                <span id="sidebar-favorites-count" class="sidebar-item-count">0</span>
            </a>
        </div>
        
        <div class="sidebar-section">
            <a href="/search" class="sidebar-item" id="sidebar-item-search">
                <span class="sidebar-item-icon">üîç</span>
                <span class="sidebar-item-title">Search</span>
            </a>
            <a href="/authors" class="sidebar-item" id="sidebar-item-authors">
                <span class="sidebar-item-icon">‚úçÔ∏è</span>
                <span class="sidebar-item-title">Authors</span>
                <span id="sidebar-authors-count" class="sidebar-item-count">0</span>
            </a>
            
            <!-- Sleep Timer (visible on mobile, hidden on desktop when player bar is visible) -->
            <div id="sidebar-sleep-timer" class="sidebar-sleep-timer-section hidden">
                <div class="sidebar-sleep-timer-header" onclick="toggleSidebarSleepTimerMenu()">
                    <span class="sidebar-item-icon">‚è∞</span>
                    <span class="sidebar-item-title">Sleep Timer</span>
                    <span id="sidebar-sleep-timer-text" class="sidebar-sleep-timer-status">Timer</span>
                </div>
                <div id="sidebar-sleep-timer-menu" class="sidebar-sleep-timer-menu hidden">
                    <div class="sleep-timer-header">
                        <span>Sleep Timer</span>
                        <div style="display: flex; gap: 8px; align-items: center;">
                            <button class="btn-help-timer" onclick="showSleepTimerHelp()" title="How it works">?</button>
                            <button class="btn-close-timer" onclick="closeSidebarSleepTimerMenu()">‚úï</button>
                        </div>
                    </div>
                    <div id="sidebar-sleep-timer-display" class="sleep-timer-display hidden">
                        <div class="sleep-timer-time">
                            <span id="sidebar-sleep-timer-countdown">0:00</span>
                            <span class="sleep-timer-label">remaining</span>
                        </div>
                        <button class="btn-cancel-timer" onclick="cancelSleepTimer()">Cancel</button>
                    </div>
                    <div id="sidebar-sleep-timer-presets" class="sleep-timer-presets">
                        <button class="btn-timer-preset" onclick="setSleepTimer(5)">5 min</button>
                        <button class="btn-timer-preset" onclick="setSleepTimer(10)">10 min</button>
                        <button class="btn-timer-preset" onclick="setSleepTimer(15)">15 min</button>
                        <button class="btn-timer-preset" onclick="setSleepTimer(30)">30 min</button>
                        <button class="btn-timer-preset" onclick="setSleepTimer(60)">1 hr</button>
                        <button class="btn-timer-preset btn-add-minutes" onclick="addSleepTimerMinutes(5)" title="Add 5 minutes">+5 min</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="sidebar-section">
            <h3 class="sidebar-section-title">Categories</h3>
            <div id="sidebar-categories" class="sidebar-categories">
                <p class="sidebar-empty">Loading categories...</p>
            </div>
        </div>
    </div>
    
    <!-- Sidebar Overlay -->
    <div id="sidebar-overlay" class="sidebar-overlay hidden" onclick="toggleSidebar()"></div>
    
    <!-- Top Bar -->
    <header class="top-bar">
        <button class="btn-menu" onclick="toggleSidebar()">‚ò∞</button>
        <button type="button" class="btn-home" onclick="navigateTo('grid', 'library')" title="Library">üè†</button>
        <div class="top-bar-search-container">
            <input 
                type="text" 
                id="top-search-input" 
                placeholder="Search..." 
                class="top-search-input"
                oninput="handleSearchInput(this.value)"
                onfocus="openSearchModal()"
            >
        </div>
        <div id="auth-button-container" class="auth-button-container">
            <div id="auth-signed-out" class="auth-signed-out-ui">
                <button type="button" class="btn-auth btn-signin" onclick="switchAuthMode('signin'); toggleAuthModal();">Sign in</button>
            </div>
            <button id="auth-button" class="btn-auth hidden" onclick="toggleAuthModal()">Account</button>
            <div id="account-dropdown" class="account-dropdown hidden">
                <div class="account-dropdown-email" id="account-dropdown-email"></div>
                <div class="account-dropdown-stats" id="account-dropdown-stats"></div>
                <button type="button" class="account-dropdown-btn" onclick="closeAccountDropdown(); openCategoryPreferencesModal();">Customize Library</button>
                <button type="button" class="account-dropdown-btn account-dropdown-signout" onclick="closeAccountDropdown(); handleSignOut();">Sign Out</button>
            </div>
        </div>
    </header>
    <!-- Main Content Area -->
    <main class="main-content">
        <!-- Grid Page -->
        <div id="page-grid" class="page active">
            <div id="loading" class="loading">
                <div class="spinner"></div>
                <p>Loading podcasts...</p>
            </div>
            <div id="error" class="error hidden">
                <h2>Error Loading Podcasts</h2>
                <p id="error-message"></p>
                <p id="error-hint" class="error-hint">If this keeps happening: check that your Supabase project is not paused (Dashboard ‚Üí Project Settings), and open DevTools ‚Üí Network to see whether the podcasts request fails or hangs.</p>
                <button onclick="loadPodcasts()" class="btn-retry">Retry</button>
            </div>
            <div id="empty" class="empty hidden">
                <p>No podcasts available</p>
            </div>
            <div id="podcast-container">
                <div id="podcast-grid" class="podcast-grid"></div>
            </div>
        </div>

        <!-- Episodes Page -->
        <div id="page-episodes" class="page hidden">
            <div class="page-header">
                <button class="btn-back" onclick="goBack()">‚Üê Back</button>
                <h1 id="episodes-page-title">Episodes</h1>
            </div>
            <div id="episodes-loading" class="loading hidden">
                <div class="spinner"></div>
                <p>Loading episodes...</p>
            </div>
            <div id="podcast-episodes-controls" class="podcast-controls hidden">
                <div class="controls-left">
                    <div class="sort-controls">
                        <label for="podcast-episodes-sort-select" class="sort-label">Sort:</label>
                        <select id="podcast-episodes-sort-select" class="sort-select" onchange="applyPodcastEpisodesSorting()">
                            <option value="title-asc">A-Z</option>
                            <option value="title-desc">Z-A</option>
                            <option value="date-desc">Newest to Oldest</option>
                            <option value="date-asc">Oldest to Newest</option>
                            <option value="random">Random</option>
                        </select>
                    </div>
                </div>
                <div class="controls-right">
                    <div id="podcast-episodes-count" class="podcast-count"></div>
                </div>
            </div>
            <div id="episodes-list" class="episodes-full-page"></div>
        </div>

        <!-- Player Page -->
        <div id="page-player" class="page hidden">
            <div class="page-header">
                <button class="btn-back" onclick="goBackToEpisode()">‚Üê Back</button>
                <h1>Now Playing</h1>
            </div>
            <div id="player-page-content" class="player-page-content">
                <div class="player-page-empty">
                    <p>No episode selected</p>
                    <p class="subtitle">Start playing an episode to see it here</p>
                </div>
            </div>
        </div>

        <!-- Category Page -->
        <div id="page-category" class="page hidden">
            <div class="page-header">
                <button class="btn-back" onclick="navigateTo('grid')">‚Üê Back</button>
                <h1 id="category-page-title">Category</h1>
            </div>
            <div id="category-loading" class="loading hidden">
                <div class="spinner"></div>
                <p>Loading podcasts...</p>
            </div>
            <div id="category-controls" class="podcast-controls">
                <div class="controls-left">
                    <div class="sort-controls">
                        <label for="category-sort-select" class="sort-label">Sort:</label>
                        <select id="category-sort-select" class="sort-select" onchange="applyCategorySorting()">
                            <option value="title-asc">A-Z</option>
                            <option value="title-desc">Z-A</option>
                        </select>
                    </div>
                </div>
            </div>
            <div id="category-grid" class="podcast-grid hidden"></div>
        </div>

        <!-- Favorites Page -->
        <div id="page-favorites" class="page hidden">
            <div class="page-header">
                <h1>Favorites</h1>
            </div>
            <div id="favorites-loading" class="loading hidden">
                <div class="spinner"></div>
                <p>Loading favorites...</p>
            </div>
            <div id="favorites-content"></div>
        </div>

        <!-- Sounds Page -->
        <div id="page-sounds" class="page hidden">
            <div class="page-header">
                <h1>Nature Sounds</h1>
            </div>
            <div id="sounds-loading" class="loading hidden">
                <div class="spinner"></div>
                <p>Loading sounds...</p>
            </div>
            <div id="sounds-controls" class="podcast-controls hidden">
                <div class="controls-left">
                    <div class="sort-controls">
                        <label for="sounds-sort-select" class="sort-label">Sort:</label>
                        <select id="sounds-sort-select" class="sort-select" onchange="applySoundsSorting()">
                            <option value="title-asc">A-Z</option>
                            <option value="title-desc">Z-A</option>
                        </select>
                    </div>
                </div>
                <div class="controls-right">
                    <div id="sounds-count" class="podcast-count"></div>
                </div>
            </div>
            <div id="sounds-container">
                <div id="sounds-grid" class="podcast-grid"></div>
                <div id="sounds-list" class="podcast-list hidden"></div>
            </div>
        </div>

        <!-- Recently Listened To Page -->
        <div id="page-recent" class="page hidden">
            <div class="page-header">
                <h1>Recently Listened To</h1>
                <button class="btn-clear-history-header" onclick="clearHistory(); loadRecentlyListenedPage(); renderSidebar();" title="Clear list">Clear All</button>
            </div>
            <div id="recent-loading" class="loading hidden">
                <div class="spinner"></div>
                <p>Loading...</p>
            </div>
            <div id="recent-list" class="episodes-full-page"></div>
        </div>

        <!-- Authors Page -->
        <div id="page-authors" class="page hidden">
            <div class="page-header">
                <button class="btn-back" onclick="navigateTo('grid')">‚Üê Back</button>
                <h1>Authors</h1>
            </div>
            <div id="authors-loading" class="loading hidden">
                <div class="spinner"></div>
                <p>Loading authors...</p>
            </div>
            <div id="authors-content" class="podcast-controls hidden">
                <div class="controls-left">
                    <div class="sort-controls">
                        <label for="authors-sort-select" class="sort-label">Sort:</label>
                        <select id="authors-sort-select" class="sort-select" onchange="applyAuthorsSorting()">
                            <option value="count-desc">Most Podcasts</option>
                            <option value="name-asc">A-Z</option>
                        </select>
                    </div>
                </div>
                <div class="controls-right">
                    <div class="view-toggle">
                        <button id="authors-view-grid" class="view-toggle-btn active" onclick="setAuthorsViewMode('grid')" title="Grid view">‚äû</button>
                        <button id="authors-view-list" class="view-toggle-btn" onclick="setAuthorsViewMode('list')" title="List view">‚ò∞</button>
                    </div>
                    <div id="authors-count" class="podcast-count"></div>
                </div>
            </div>
            <div id="authors-container">
                <div id="authors-grid" class="podcast-grid hidden"></div>
                <div id="authors-list" class="podcast-list"></div>
            </div>
        </div>

        <!-- Author Detail Page -->
        <div id="page-author" class="page hidden">
            <div class="page-header">
                <button class="btn-back" onclick="navigateTo('authors')">‚Üê Back</button>
                <h1 id="author-page-title">Author</h1>
            </div>
            <div id="author-loading" class="loading hidden">
                <div class="spinner"></div>
                <p>Loading author...</p>
            </div>
            <div id="author-content" class="author-detail-content hidden">
                <div id="author-description" class="author-description">
                    <p class="author-description-placeholder">No description available yet.</p>
                </div>
                <div id="author-podcasts-section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h2 class="author-section-title">Podcasts</h2>
                        <div class="sort-controls">
                            <label for="author-podcasts-sort-select" class="sort-label">Sort:</label>
                            <select id="author-podcasts-sort-select" class="sort-select" onchange="applyAuthorPodcastsSorting()">
                                <option value="title-asc">A-Z</option>
                                <option value="title-desc">Z-A</option>
                            </select>
                        </div>
                    </div>
                    <div id="author-podcasts-grid" class="podcast-grid"></div>
                </div>
            </div>
        </div>

        <!-- Episode Detail Page -->
        <div id="page-episode" class="page hidden">
            <div class="page-header">
                <button class="btn-back" onclick="goBackFromEpisode()">‚Üê Back</button>
                <h1 id="episode-page-title">Episode</h1>
            </div>
            <div id="episode-detail-content" class="episode-detail-content"></div>
        </div>

        <!-- Sound Detail Page -->
        <div id="page-sound" class="page hidden">
            <div id="sound-detail-background" class="sound-detail-background"></div>
            <div class="sound-detail-content">
                <div class="sound-detail-header">
                    <button class="btn-back" onclick="goBackFromSound()">‚Üê Back</button>
                </div>
                <div id="sound-detail-main" class="sound-detail-main">
                    <div class="sound-detail-image-container">
                        <img id="sound-detail-image" src="" alt="" class="sound-detail-image">
                    </div>
                    <div class="sound-detail-info">
                        <h1 id="sound-detail-title" class="sound-detail-title">Nature Sound</h1>
                        <div class="sound-detail-controls">
                            <button id="sound-detail-play-btn" class="btn-sound-detail-play" onclick="toggleSoundPlayPause()">
                                <span id="sound-detail-play-icon">‚ñ∂</span>
                            </button>
                            <button class="btn-sound-detail-stop" onclick="stopSound()" title="Stop">
                                <span>‚èπ</span>
                            </button>
                        </div>
                        <div id="sound-detail-description" class="sound-detail-description"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Search Page / All Episodes Page -->
        <div id="page-search" class="page hidden">
            <div class="page-header">
                <h1 id="search-page-title">Search</h1>
            </div>
            <div class="search-container">
                <div id="search-results" class="search-results">
                    <div class="empty"><p>Start typing in the search bar above...</p></div>
                </div>
            </div>
        </div>
        
        <!-- All Episodes Page -->
        <div id="page-all-episodes" class="page hidden">
            <div class="page-header">
                <h1>All Episodes</h1>
            </div>
            <div id="episodes-controls" class="podcast-controls">
                <div class="controls-left">
                    <div class="sort-controls">
                        <label for="episodes-sort-select" class="sort-label">Sort:</label>
                        <select id="episodes-sort-select" class="sort-select" onchange="applyEpisodesSorting()">
                            <option value="title-asc">A-Z</option>
                            <option value="title-desc">Z-A</option>
                            <option value="date-desc">Newest to Oldest</option>
                            <option value="date-asc">Oldest to Newest</option>
                            <option value="random">Random</option>
                        </select>
                    </div>
                    <div class="filter-controls">
                        <label for="episodes-duration-filter" class="filter-label">Episode Duration:</label>
                        <select id="episodes-duration-filter" class="filter-select" onchange="applyEpisodesDurationFilter()">
                            <option value="all">All Durations</option>
                            <option value="under10">Under 10 min</option>
                            <option value="10-30">10-30 min</option>
                            <option value="30-60">30-60 min</option>
                            <option value="60plus">60+ min</option>
                        </select>
                    </div>
                </div>
                <div class="controls-right">
                    <div id="episodes-count" class="podcast-count"></div>
                </div>
            </div>
            <div id="all-episodes-list" class="episodes-full-page"></div>
        </div>
    </main>

    <!-- Persistent Audio Player (always visible when playing episodes) -->
    <div id="player-bar" class="player-bar hidden">
        <div class="player-bar-content">
            <div class="player-bar-main">
                <div class="player-bar-info" onclick="goToNowPlayingPodcast()">
                    <div class="player-bar-artwork">
                        <img id="player-bar-image" src="" alt="" onerror="this.style.display='none'">
                    </div>
                    <div class="player-bar-text">
                        <h3 id="player-bar-title">Now Playing</h3>
                        <p id="player-bar-episode">Select an episode</p>
                    </div>
                </div>
            </div>
            <div class="player-bar-center">
                <div class="player-bar-controls">
                    <button class="btn-skip-text-only" onclick="skipBackward()" title="Skip back 10s">
                        <span class="skip-number">-10</span>
                    </button>
                    <button id="play-pause-btn-bar" class="btn-play-pause-main" onclick="togglePlayPause()">
                        <span id="play-icon-bar">‚ñ∂</span>
                    </button>
                    <button class="btn-skip-text-only" onclick="skipForward()" title="Skip forward 30s">
                        <span class="skip-number">+30</span>
                    </button>
                </div>
                <div class="player-bar-progress-wrapper">
                    <div class="player-bar-time-left" id="current-time-bar">0:00</div>
                    <div class="player-bar-progress" id="player-bar-progress" onclick="seekToPosition(event)">
                        <div class="player-bar-progress-fill" id="player-bar-progress-fill"></div>
                    </div>
                    <div class="player-bar-time-right" id="duration-bar">0:00</div>
                </div>
            </div>
            <div class="player-bar-right">
                <div class="player-bar-speed-control">
                    <button id="playback-speed-btn" class="btn-player-control" onclick="togglePlaybackSpeedMenu()" title="Playback Speed">
                        <span id="playback-speed-text">1x</span>
                    </button>
                    <div id="playback-speed-menu" class="player-control-menu hidden">
                        <button class="player-control-option" onclick="setPlaybackSpeed(0.5)">0.5x</button>
                        <button class="player-control-option" onclick="setPlaybackSpeed(0.75)">0.75x</button>
                        <button class="player-control-option active" onclick="setPlaybackSpeed(1.0)">1x</button>
                        <button class="player-control-option" onclick="setPlaybackSpeed(1.25)">1.25x</button>
                        <button class="player-control-option" onclick="setPlaybackSpeed(1.5)">1.5x</button>
                        <button class="player-control-option" onclick="setPlaybackSpeed(2.0)">2x</button>
                    </div>
                </div>
                <div class="player-bar-volume-control">
                    <button id="volume-btn" class="btn-player-control" onclick="toggleVolumeControl()" title="Volume">
                        <span id="volume-icon">üîä</span>
                    </button>
                    <div id="volume-control" class="player-volume-slider hidden">
                        <input type="range" id="volume-slider" min="0" max="100" value="100" oninput="setVolume(this.value / 100)" title="Volume">
                    </div>
                </div>
                <div class="sleep-timer-container">
                    <button id="sleep-timer-btn" class="btn-sleep-timer-small" onclick="toggleSleepTimerMenu()" title="Sleep Timer">
                        <span id="sleep-timer-icon">‚è∞</span>
                        <span id="sleep-timer-text" class="sleep-timer-text-small">Timer</span>
                    </button>
                    <div id="sleep-timer-menu" class="sleep-timer-menu hidden">
                        <div class="sleep-timer-header">
                            <span>Sleep Timer</span>
                            <div style="display: flex; gap: 8px; align-items: center;">
                                <button class="btn-help-timer" onclick="showSleepTimerHelp()" title="How it works">?</button>
                                <button class="btn-close-timer" onclick="closeSleepTimerMenu()">‚úï</button>
                            </div>
                        </div>
                        <div id="sleep-timer-display" class="sleep-timer-display hidden">
                            <div class="sleep-timer-time">
                                <span id="sleep-timer-countdown">0:00</span>
                                <span class="sleep-timer-label">remaining</span>
                            </div>
                            <button class="btn-cancel-timer" onclick="cancelSleepTimer()">Cancel</button>
                        </div>
                        <div id="sleep-timer-presets" class="sleep-timer-presets">
                            <button class="btn-timer-preset" onclick="setSleepTimer(5)">5 min</button>
                            <button class="btn-timer-preset" onclick="setSleepTimer(10)">10 min</button>
                            <button class="btn-timer-preset" onclick="setSleepTimer(15)">15 min</button>
                            <button class="btn-timer-preset" onclick="setSleepTimer(30)">30 min</button>
                            <button class="btn-timer-preset" onclick="setSleepTimer(60)">1 hr</button>
                            <button class="btn-timer-preset btn-add-minutes" onclick="addSleepTimerMinutes(5)" title="Add 5 minutes">+5 min</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <audio id="audio-player" preload="none"></audio>
    </div>

    <!-- Search Modal (Spotlight-like) -->
    <div id="search-modal" class="search-modal hidden">
        <div class="search-modal-overlay" onclick="closeSearchModal()"></div>
        <div class="search-modal-content">
            <div class="search-modal-header">
                <div class="search-mode-toggle-modal">
                    <button id="search-mode-episodes-modal" class="search-mode-btn active" onclick="setSearchModeModal('episodes')">Episodes</button>
                    <button id="search-mode-podcasts-modal" class="search-mode-btn" onclick="setSearchModeModal('podcasts')">Podcasts</button>
                </div>
                <button class="search-modal-close" onclick="closeSearchModal()">‚úï</button>
            </div>
            <div class="search-modal-input-wrapper">
                <input 
                    type="text" 
                    id="search-modal-input" 
                    placeholder="Search..." 
                    class="search-modal-input"
                    oninput="handleSearchModalInput(this.value)"
                    autocomplete="off"
                >
            </div>
            <div id="search-modal-results" class="search-modal-results">
                <div class="search-modal-empty">
                    <p>Start typing to search...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Search Modal (Spotlight-like) -->
    <div id="search-modal" class="search-modal hidden">
        <div class="search-modal-overlay" onclick="closeSearchModal()"></div>
        <div class="search-modal-content">
            <div class="search-modal-header">
                <div class="search-mode-toggle-modal">
                    <button id="search-mode-episodes-modal" class="search-mode-btn active" onclick="setSearchModeModal('episodes')">Episodes</button>
                    <button id="search-mode-podcasts-modal" class="search-mode-btn" onclick="setSearchModeModal('podcasts')">Podcasts</button>
                </div>
                <button class="search-modal-close" onclick="closeSearchModal()">‚úï</button>
            </div>
            <div class="search-modal-input-wrapper">
                <input 
                    type="text" 
                    id="search-modal-input" 
                    placeholder="Search..." 
                    class="search-modal-input"
                    oninput="handleSearchModalInput(this.value)"
                    autocomplete="off"
                >
            </div>
            <div id="search-modal-results" class="search-modal-results">
                <div class="search-modal-empty">
                    <p>Start typing to search...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Simple Sound Player (for looping nature sounds) -->
    <div id="sound-player-bar" class="sound-player-bar hidden">
        <div class="sound-player-content">
            <div class="sound-player-main">
                <div class="sound-player-info">
                    <h3 id="sound-player-title" class="sound-player-title">Nature Sound</h3>
                </div>
                <button id="sound-player-play-btn" class="sound-player-play-btn" onclick="toggleSoundPlayPause()">
                    <span id="sound-player-play-icon">‚ñ∂</span>
                </button>
            </div>
            <div class="sound-player-timer">
                <button id="sound-sleep-timer-btn" class="btn-sleep-timer-small" onclick="toggleSleepTimerMenu()" title="Sleep Timer">
                    <span id="sound-sleep-timer-icon">‚è∞</span>
                    <span id="sound-sleep-timer-text" class="sleep-timer-text-small">Timer</span>
                </button>
                <div id="sound-sleep-timer-menu" class="sleep-timer-menu hidden">
                    <div class="sleep-timer-header">
                        <span>Sleep Timer</span>
                        <button class="btn-close-timer" onclick="closeSleepTimerMenu()">‚úï</button>
                    </div>
                    <div id="sound-sleep-timer-display" class="sleep-timer-display hidden">
                        <div class="sleep-timer-time">
                            <span id="sound-sleep-timer-countdown">0:00</span>
                            <span class="sleep-timer-label">remaining</span>
                        </div>
                        <button class="btn-cancel-timer" onclick="cancelSleepTimer()">Cancel</button>
                    </div>
                    <div id="sound-sleep-timer-presets" class="sleep-timer-presets">
                        <button class="btn-timer-preset" onclick="setSleepTimer(5)">5 min</button>
                        <button class="btn-timer-preset" onclick="setSleepTimer(10)">10 min</button>
                        <button class="btn-timer-preset" onclick="setSleepTimer(15)">15 min</button>
                        <button class="btn-timer-preset" onclick="setSleepTimer(30)">30 min</button>
                        <button class="btn-timer-preset" onclick="setSleepTimer(60)">1 hr</button>
                        <button class="btn-timer-preset btn-add-minutes" onclick="addSleepTimerMinutes(5)" title="Add 5 minutes">+5 min</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Auth Modal -->
    <div id="auth-modal" class="auth-modal hidden">
        <div class="auth-modal-overlay" onclick="closeAuthModal()"></div>
        <div class="auth-modal-content">
            <div class="auth-modal-header">
                <h2 id="auth-modal-title">Save Progress</h2>
                <button class="btn-close-modal" onclick="closeAuthModal()">‚úï</button>
            </div>
            <div class="auth-modal-body">
                <div id="auth-error" class="auth-error hidden"></div>
                <div id="auth-success" class="auth-success hidden"></div>
                
                <div id="auth-signin-form" class="auth-form">
                    <div class="auth-form-group">
                        <label for="signin-email">Email</label>
                        <input type="email" id="signin-email" class="auth-input" placeholder="your@email.com">
                    </div>
                    <div class="auth-form-group">
                        <label for="signin-password">Password</label>
                        <input type="password" id="signin-password" class="auth-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                    </div>
                    <p style="text-align: right; margin-top: -0.5rem; margin-bottom: 1rem;">
                        <a href="#" onclick="switchAuthMode('forgot'); return false;" style="font-size: 0.9rem; color: #0066cc; text-decoration: none;">Forgot password?</a>
                    </p>
                    <button class="btn-auth-primary" onclick="handleSignIn()">Sign In</button>
                    <p class="auth-switch-text">
                        Don't have an account?
                        <a href="#" onclick="switchAuthMode('signup'); return false;">Create account</a>
                    </p>
                    <p class="auth-legal-links" style="margin-top: 1rem; font-size: 0.85rem; text-align: center; color: #666;">
                        By signing in, you agree to our 
                        <a href="/terms" target="_blank" style="color: #0066cc; text-decoration: underline;">Terms of Service</a> 
                        and 
                        <a href="/privacy" target="_blank" style="color: #0066cc; text-decoration: underline;">Privacy Policy</a>
                    </p>
                </div>

                <div id="auth-signup-form" class="auth-form hidden">
                    <div class="auth-benefits" style="background: var(--bg-tertiary); padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem;">
                        <h3 style="margin: 0 0 0.75rem 0; font-size: 1rem; color: var(--text-primary);">Why save your progress?</h3>
                        <ul style="margin: 0; padding-left: 1.25rem; color: var(--text-secondary); font-size: 0.9rem; line-height: 1.6;">
                            <li>Remember where you left off on every podcast</li>
                            <li>Keep your favorites and listening history</li>
                            <li>Choose which categories appear on your Library</li>
                            <li>Sync across devices ‚Äî free and secure</li>
                        </ul>
                    </div>
                    <div class="auth-form-group">
                        <label for="signup-email">Email</label>
                        <input type="email" id="signup-email" class="auth-input" placeholder="your@email.com">
                    </div>
                    <div class="auth-form-group">
                        <label for="signup-password">Password</label>
                        <input type="password" id="signup-password" class="auth-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                    </div>
                    <div class="auth-form-group">
                        <label for="signup-password-confirm">Confirm Password</label>
                        <input type="password" id="signup-password-confirm" class="auth-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                    </div>
                    <button class="btn-auth-primary" onclick="handleSignUp()">Save Progress</button>
                    <p class="auth-switch-text">
                        Already have an account?
                        <a href="#" onclick="switchAuthMode('signin'); return false;">Sign in</a>
                    </p>
                    <p class="auth-legal-links" style="margin-top: 1rem; font-size: 0.85rem; text-align: center; color: #666;">
                        By signing up, you agree to our 
                        <a href="/terms" target="_blank" style="color: #0066cc; text-decoration: underline;">Terms of Service</a> 
                        and 
                        <a href="/privacy" target="_blank" style="color: #0066cc; text-decoration: underline;">Privacy Policy</a>
                    </p>
                </div>

                <div id="auth-forgot-form" class="auth-form hidden">
                    <p style="margin-bottom: 1rem; color: #666;">Enter your email address and we'll send you a link to reset your password.</p>
                    <div class="auth-form-group">
                        <label for="forgot-email">Email</label>
                        <input type="email" id="forgot-email" class="auth-input" placeholder="your@email.com">
                    </div>
                    <button class="btn-auth-primary" onclick="handleForgotPassword()">Send Reset Link</button>
                    <p class="auth-switch-text">
                        Remember your password? 
                        <a href="#" onclick="switchAuthMode('signin'); return false;">Sign in</a>
                    </p>
                </div>

                <div id="auth-reset-form" class="auth-form hidden">
                    <p style="margin-bottom: 1rem; color: #666;">Enter your new password.</p>
                    <div class="auth-form-group">
                        <label for="reset-password">New Password</label>
                        <input type="password" id="reset-password" class="auth-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                    </div>
                    <div class="auth-form-group">
                        <label for="reset-password-confirm">Confirm New Password</label>
                        <input type="password" id="reset-password-confirm" class="auth-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                    </div>
                    <button class="btn-auth-primary" onclick="handleResetPassword()">Update Password</button>
                    <p class="auth-switch-text">
                        <a href="#" onclick="switchAuthMode('signin'); return false;">Back to sign in</a>
                    </p>
                </div>

                <div id="auth-signedin" class="auth-signedin hidden">
                    <p>Signed in as <strong id="auth-user-email"></strong></p>
                    <p class="auth-sync-status" id="auth-sync-status">Syncing...</p>
                    <p class="auth-signedin-note" style="font-size: 0.9rem; color: var(--text-secondary); margin: 0.75rem 0;">Your listening progress, favorites, and library preferences are saved and sync across devices.</p>
                    <button type="button" class="btn-auth-primary" id="btn-customize-library" onclick="openCategoryPreferencesModal()">Customize Library</button>
                    <button class="btn-auth-secondary" onclick="handleSignOut()">Sign Out</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Category preferences modal (logged-in users) -->
    <div id="category-preferences-modal" class="auth-modal hidden">
        <div class="auth-modal-overlay" onclick="closeCategoryPreferencesModal()"></div>
        <div class="auth-modal-content" style="max-width: 480px;">
            <div class="auth-modal-header">
                <h2>Customize Library</h2>
                <button class="btn-close-modal" onclick="closeCategoryPreferencesModal()">‚úï</button>
            </div>
            <div class="auth-modal-body">
                <p style="margin: 0 0 1rem 0; font-size: 0.9rem; color: var(--text-secondary);">Select which categories appear on your Library. Leave all checked to show everything.</p>
                <div class="category-pref-actions" style="display: flex; gap: 1rem; margin-bottom: 0.75rem; font-size: 0.9rem;">
                    <button type="button" class="btn-link" onclick="selectAllCategoryPreferences()">Select all</button>
                    <button type="button" class="btn-link" onclick="deselectAllCategoryPreferences()">Deselect all</button>
                </div>
                <div id="category-preferences-list" class="category-preferences-list"></div>
                <div id="category-pref-saved-msg" class="category-pref-saved-msg hidden">Saved ‚úì</div>
                <div style="display: flex; gap: 10px; margin-top: 1.25rem;">
                    <button type="button" class="btn-auth-primary" id="category-pref-save-btn" onclick="window.saveCategoryPreferences()">Save</button>
                    <button type="button" class="btn-auth-secondary" onclick="closeCategoryPreferencesModal()">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Supabase JS -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="/web/config.js"></script>
    <script src="/web/api.js"></script>
    <script src="/web/auth.js"></script>
    <script src="/web/analytics.js"></script>
    <script src="/web/app.js"></script>
    
    <!-- GA Debug Helper (remove in production) -->
    <script>
        // Debug helper - check if GA loaded
        window.addEventListener('load', function() {
            setTimeout(function() {
                if (typeof window.gtag === 'function') {
                    console.log('‚úÖ Google Analytics loaded successfully');
                    console.log('Measurement ID: G-9CDHCMHT8J');
                    console.log('DataLayer length:', window.dataLayer ? window.dataLayer.length : 0);
                    console.log('');
                    console.log('üìä To verify events are being sent:');
                    console.log('1. Open Network tab (F12 ‚Üí Network)');
                    console.log('2. Filter by "collect" or "google-analytics"');
                    console.log('3. Interact with the site (play episode, search, etc.)');
                    console.log('4. Look for requests to google-analytics.com/g/collect');
                    console.log('');
                    console.log('üß™ Test manually: Run window.testGA4() in console');
                } else {
                    console.error('‚ùå Google Analytics NOT loaded');
                    console.log('Check for ad blockers or network errors');
                    console.log('Make sure you are on the live site (not localhost)');
                }
            }, 1000);
        });
        
        // Manual test function for Step 1 verification
        window.testGA4 = function() {
            if (typeof window.gtag !== 'function') {
                console.error('‚ùå GA4 not loaded. Check for ad blockers or network errors.');
                return;
            }
            console.log('üß™ Sending test event...');
            window.gtag('event', 'test_manual_event', {
                event_category: 'test',
                event_label: 'console_test',
                test_timestamp: new Date().toISOString()
            });
            console.log('‚úÖ Test event sent!');
            console.log('üìä Now check:');
            console.log('   1. Network tab ‚Üí Filter by "collect" ‚Üí Look for google-analytics.com/g/collect');
            console.log('   2. GA4 Real-time reports ‚Üí Should appear within 30 seconds');
        };
    </script>
    <!-- Vercel Analytics -->
    <script type="module">
        import { inject } from 'https://esm.sh/@vercel/analytics@1';
        inject();
    </script>

    <!-- Sleep Timer Help Modal -->
    <div id="sleep-timer-help-modal" class="auth-modal hidden">
        <div class="auth-modal-overlay" onclick="closeSleepTimerHelp()"></div>
        <div class="auth-modal-content" style="max-width: 500px;">
            <div class="auth-modal-header">
                <h2>Sleep Timer</h2>
                <button class="btn-close-modal" onclick="closeSleepTimerHelp()">‚úï</button>
            </div>
            <div class="auth-modal-body">
                <div style="padding: 20px 0;">
                    <p style="margin-bottom: 16px; line-height: 1.6;">
                        The Sleep Timer automatically pauses your audio after a set amount of time. Perfect for falling asleep to podcasts or nature sounds!
                    </p>
                    <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 12px; margin-top: 24px;">How it works:</h3>
                    <ul style="margin-left: 20px; line-height: 1.8;">
                        <li>Select a preset time (5 min, 10 min, 15 min, 30 min, or 1 hour)</li>
                        <li>Or use the "+5 min" button to add more time to an active timer</li>
                        <li>When the timer ends, your audio will pause automatically</li>
                        <li>You can cancel the timer at any time</li>
                        <li>The timer works for both podcasts and nature sounds</li>
                    </ul>
                    <p style="margin-top: 20px; padding: 12px; background: var(--bg-tertiary); border-radius: 8px; font-size: 14px; line-height: 1.6;">
                        <strong>Tip:</strong> The timer countdown is shown in the sidebar and player bar. You can always access it from the sidebar menu.
                    </p>
                </div>
                <button class="btn-auth-primary" onclick="closeSleepTimerHelp()" style="width: 100%;">Got it!</button>
            </div>
        </div>
    </div>

    <!-- Navigation Help Modal -->
    <div id="navigation-help-modal" class="auth-modal hidden">
        <div class="auth-modal-overlay" onclick="closeNavigationHelp()"></div>
        <div class="auth-modal-content" style="max-width: 600px;">
            <div class="auth-modal-header">
                <h2>Navigation Guide</h2>
                <button class="btn-close-modal" onclick="closeNavigationHelp()">‚úï</button>
            </div>
            <div class="auth-modal-body">
                <div style="padding: 20px 0;">
                    <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 12px; margin-top: 0;">Getting Started</h3>
                    <p style="margin-bottom: 16px; line-height: 1.6;">
                        Welcome to Podcast Library! Here's how to navigate and get the most out of the app.
                    </p>
                    
                    <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 12px; margin-top: 24px;">üîç Search</h3>
                    <ul style="margin-left: 20px; line-height: 1.8; margin-bottom: 20px;">
                        <li>Use the search bar at the top to find podcasts or episodes</li>
                        <li>Toggle between "Episodes" and "Podcasts" search modes</li>
                        <li>Click any result to view details and start listening</li>
                    </ul>

                    <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 12px; margin-top: 24px;">üïí History</h3>
                    <ul style="margin-left: 20px; line-height: 1.8; margin-bottom: 20px;">
                        <li>View all podcasts and episodes you've listened to</li>
                        <li>The number shows unique items you've played</li>
                        <li>Click "Clear History" to remove all history</li>
                    </ul>

                    <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 12px; margin-top: 24px;">‚≠ê Favorites</h3>
                    <ul style="margin-left: 20px; line-height: 1.8; margin-bottom: 20px;">
                        <li>Click the heart icon on any podcast or episode to favorite it</li>
                        <li>Access all your favorites from the sidebar</li>
                        <li>Organize your favorite content for easy access</li>
                    </ul>

                    <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 12px; margin-top: 24px;">‚úçÔ∏è Authors</h3>
                    <ul style="margin-left: 20px; line-height: 1.8; margin-bottom: 20px;">
                        <li>Browse podcasts by author</li>
                        <li>See all podcasts from your favorite creators</li>
                        <li>Click an author to view their podcast collection</li>
                    </ul>

                    <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 12px; margin-top: 24px;">üìÇ Categories</h3>
                    <ul style="margin-left: 20px; line-height: 1.8; margin-bottom: 20px;">
                        <li>Explore podcasts by category (Arts, Business, Comedy, etc.)</li>
                        <li>Click any category to see all podcasts in that genre</li>
                        <li>Numbers show how many podcasts are in each category</li>
                    </ul>

                    <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 12px; margin-top: 24px;">üéµ Playing Audio</h3>
                    <ul style="margin-left: 20px; line-height: 1.8; margin-bottom: 20px;">
                        <li>Click the play button (‚ñ∂) on any episode to start listening</li>
                        <li>The player bar at the bottom shows what's currently playing</li>
                        <li>Use skip buttons to jump forward/backward 15 seconds</li>
                        <li>Progress is automatically saved - resume where you left off</li>
                    </ul>

                    <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 12px; margin-top: 24px;">‚è∞ Sleep Timer</h3>
                    <ul style="margin-left: 20px; line-height: 1.8; margin-bottom: 20px;">
                        <li>Set a timer to automatically pause audio after a set time</li>
                        <li>Perfect for falling asleep to podcasts</li>
                        <li>Access from the sidebar or player bar</li>
                    </ul>

                    <div style="margin-top: 24px; padding: 16px; background: var(--bg-tertiary); border-radius: 8px; border-left: 3px solid var(--accent);">
                        <p style="margin: 0; font-size: 14px; line-height: 1.6;">
                            <strong>üí° Tip:</strong> On desktop, the sidebar stays open by default. On mobile, tap the menu icon (‚ò∞) to open it. You can close the sidebar anytime using the X button.
                        </p>
                    </div>
                </div>
                <button class="btn-auth-primary" onclick="closeNavigationHelp()" style="width: 100%;">Got it!</button>
            </div>
        </div>
    </div>
</body>
</html>
