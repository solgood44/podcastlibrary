<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Podcast Library</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/web/favicon.svg">
    <link rel="apple-touch-icon" href="/web/favicon.svg">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://podcastlibrary.org/">
    <meta property="og:title" content="Podcast Library">
    <meta property="og:description" content="Discover and listen to thousands of podcasts, audiobooks, and audio content. Browse by author, category, or search for your favorite shows.">
    <meta property="og:image" content="https://podcastlibrary.org/web/og-image.svg">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://podcastlibrary.org/">
    <meta name="twitter:title" content="Podcast Library">
    <meta name="twitter:description" content="Discover and listen to thousands of podcasts, audiobooks, and audio content.">
    <meta name="twitter:image" content="https://podcastlibrary.org/web/og-image.svg">
    
    <!-- Additional Meta -->
    <meta name="description" content="Discover and listen to thousands of podcasts, audiobooks, and audio content. Browse by author, category, or search for your favorite shows.">
    
    <link rel="stylesheet" href="/web/styles.css">
</head>
<body class="dark-mode">
    <!-- Sidebar -->
    <div id="sidebar" class="sidebar">
        <div class="sidebar-header">
            <h2>Menu</h2>
            <button class="btn-close-sidebar" onclick="toggleSidebar()">‚úï</button>
        </div>
        
        <div class="sidebar-section">
            <div class="sidebar-item" onclick="navigateTo('grid')">
                <span class="sidebar-item-icon">üîç</span>
                <span class="sidebar-item-title">Search</span>
            </div>
            <div class="sidebar-item" onclick="navigateTo('history')">
                <span class="sidebar-item-icon">üïí</span>
                <span class="sidebar-item-title">History</span>
                <span id="sidebar-history-count" class="sidebar-item-count">0</span>
            </div>
            <div class="sidebar-item" onclick="navigateTo('favorites')">
                <span class="sidebar-item-icon">‚≠ê</span>
                <span class="sidebar-item-title">Favorites</span>
                <span id="sidebar-favorites-count" class="sidebar-item-count">0</span>
            </div>
            <div class="sidebar-item" onclick="navigateTo('authors')">
                <span class="sidebar-item-icon">‚úçÔ∏è</span>
                <span class="sidebar-item-title">Authors</span>
            </div>
        </div>
        
        <div class="sidebar-section">
            <h3 class="sidebar-section-title">Categories</h3>
            <div id="sidebar-categories" class="sidebar-categories">
                <p class="sidebar-empty">Loading categories...</p>
            </div>
        </div>
    </div>
    
    <!-- Sidebar Overlay -->
    <div id="sidebar-overlay" class="sidebar-overlay hidden" onclick="toggleSidebar()"></div>
    
    <!-- Top Bar -->
    <header class="top-bar">
        <button class="btn-menu" onclick="toggleSidebar()">‚ò∞</button>
        <div class="top-bar-search-container">
            <div class="search-mode-toggle">
                <button id="search-mode-episodes" class="search-mode-btn active" onclick="setSearchMode('episodes')">Episodes</button>
                <button id="search-mode-podcasts" class="search-mode-btn" onclick="setSearchMode('podcasts')">Podcasts</button>
            </div>
            <select id="search-mode-dropdown" class="search-mode-dropdown" onchange="setSearchMode(this.value)">
                <option value="episodes" selected>Episodes</option>
                <option value="podcasts">Podcasts</option>
            </select>
            <input 
                type="text" 
                id="top-search-input" 
                placeholder="Search..." 
                class="top-search-input"
                oninput="handleSearchInput(this.value)"
                onfocus="handleSearchFocus()"
            >
        </div>
        <div id="auth-button-container" class="auth-button-container">
            <button id="auth-button" class="btn-auth" onclick="toggleAuthModal()">Sign In</button>
        </div>
    </header>
    <!-- Main Content Area -->
    <main class="main-content">
        <!-- Grid Page -->
        <div id="page-grid" class="page active">
            <div id="loading" class="loading">
                <div class="spinner"></div>
                <p>Loading podcasts...</p>
            </div>
            <div id="error" class="error hidden">
                <h2>Error Loading Podcasts</h2>
                <p id="error-message"></p>
                <button onclick="loadPodcasts()" class="btn-retry">Retry</button>
            </div>
            <div id="empty" class="empty hidden">
                <p>No podcasts available</p>
            </div>
            <div id="podcast-controls" class="podcast-controls hidden">
                <div class="controls-left">
                    <div class="view-toggle">
                        <button id="view-grid-btn" class="view-btn active" onclick="setViewMode('grid')" title="Grid View">
                            <span>‚äû</span>
                        </button>
                        <button id="view-list-btn" class="view-btn" onclick="setViewMode('list')" title="List View">
                            <span>‚ò∞</span>
                        </button>
                    </div>
                    <div class="sort-controls">
                        <label for="sort-select" class="sort-label">Sort:</label>
                        <select id="sort-select" class="sort-select" onchange="applySorting()">
                            <option value="title-asc">A-Z</option>
                            <option value="title-desc">Z-A</option>
                        </select>
                    </div>
                    <div class="filter-controls">
                        <label for="duration-filter" class="filter-label">Episode Duration:</label>
                        <select id="duration-filter" class="filter-select" onchange="applyDurationFilter()">
                            <option value="all">All Durations</option>
                            <option value="under10">Under 10 min</option>
                            <option value="10-30">10-30 min</option>
                            <option value="30-60">30-60 min</option>
                            <option value="60plus">60+ min</option>
                        </select>
                    </div>
                </div>
                <div class="controls-right">
                    <div id="podcast-count" class="podcast-count"></div>
                </div>
            </div>
            <div id="podcast-container">
                <div id="podcast-grid" class="podcast-grid"></div>
                <div id="podcast-list" class="podcast-list hidden"></div>
            </div>
        </div>

        <!-- Episodes Page -->
        <div id="page-episodes" class="page hidden">
            <div class="page-header">
                <button class="btn-back" onclick="goBackToLibrary()">‚Üê Back</button>
                <h1 id="episodes-page-title">Episodes</h1>
            </div>
            <div id="episodes-loading" class="loading hidden">
                <div class="spinner"></div>
                <p>Loading episodes...</p>
            </div>
            <div id="podcast-episodes-controls" class="podcast-controls hidden">
                <div class="controls-left">
                    <div class="sort-controls">
                        <label for="podcast-episodes-sort-select" class="sort-label">Sort:</label>
                        <select id="podcast-episodes-sort-select" class="sort-select" onchange="applyPodcastEpisodesSorting()">
                            <option value="title-asc">A-Z</option>
                            <option value="title-desc">Z-A</option>
                            <option value="date-desc">Newest to Oldest</option>
                            <option value="date-asc">Oldest to Newest</option>
                        </select>
                    </div>
                </div>
                <div class="controls-right">
                    <div id="podcast-episodes-count" class="podcast-count"></div>
                </div>
            </div>
            <div id="episodes-list" class="episodes-full-page"></div>
        </div>

        <!-- Player Page -->
        <div id="page-player" class="page hidden">
            <div class="page-header">
                <button class="btn-back" onclick="goBackToEpisode()">‚Üê Back</button>
                <h1>Now Playing</h1>
            </div>
            <div id="player-page-content" class="player-page-content">
                <div class="player-page-empty">
                    <p>No episode selected</p>
                    <p class="subtitle">Start playing an episode to see it here</p>
                </div>
            </div>
        </div>

        <!-- Category Page -->
        <div id="page-category" class="page hidden">
            <div class="page-header">
                <button class="btn-back" onclick="navigateTo('grid')">‚Üê Back</button>
                <h1 id="category-page-title">Category</h1>
            </div>
            <div id="category-loading" class="loading hidden">
                <div class="spinner"></div>
                <p>Loading podcasts...</p>
            </div>
            <div id="category-grid" class="podcast-grid hidden"></div>
        </div>

        <!-- Favorites Page -->
        <div id="page-favorites" class="page hidden">
            <div class="page-header">
                <h1>Favorites</h1>
            </div>
            <div id="favorites-loading" class="loading hidden">
                <div class="spinner"></div>
                <p>Loading favorites...</p>
            </div>
            <div id="favorites-content"></div>
        </div>

        <!-- History Page -->
        <div id="page-history" class="page hidden">
            <div class="page-header">
                <h1>Recent Episodes</h1>
                <button class="btn-clear-history-header" onclick="clearHistory(); navigateTo('history')" title="Clear history">Clear History</button>
            </div>
            <div id="history-loading" class="loading hidden">
                <div class="spinner"></div>
                <p>Loading history...</p>
            </div>
            <div id="history-list" class="episodes-full-page"></div>
        </div>

        <!-- Authors Page -->
        <div id="page-authors" class="page hidden">
            <div class="page-header">
                <button class="btn-back" onclick="navigateTo('grid')">‚Üê Back</button>
                <h1>Authors</h1>
            </div>
            <div id="authors-loading" class="loading hidden">
                <div class="spinner"></div>
                <p>Loading authors...</p>
            </div>
            <div id="authors-content" class="podcast-controls hidden">
                <div class="controls-left">
                    <div class="sort-controls">
                        <label for="authors-sort-select" class="sort-label">Sort:</label>
                        <select id="authors-sort-select" class="sort-select" onchange="applyAuthorsSorting()">
                            <option value="count-desc">Most Podcasts</option>
                            <option value="name-asc">A-Z</option>
                        </select>
                    </div>
                </div>
                <div class="controls-right">
                    <div id="authors-count" class="podcast-count"></div>
                </div>
            </div>
            <div id="authors-container">
                <div id="authors-list" class="podcast-list"></div>
            </div>
        </div>

        <!-- Author Detail Page -->
        <div id="page-author" class="page hidden">
            <div class="page-header">
                <button class="btn-back" onclick="navigateTo('authors')">‚Üê Back</button>
                <h1 id="author-page-title">Author</h1>
            </div>
            <div id="author-loading" class="loading hidden">
                <div class="spinner"></div>
                <p>Loading author...</p>
            </div>
            <div id="author-content" class="author-detail-content hidden">
                <div id="author-description" class="author-description">
                    <p class="author-description-placeholder">No description available yet.</p>
                </div>
                <div id="author-podcasts-section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h2 class="author-section-title">Podcasts</h2>
                        <div class="sort-controls">
                            <label for="author-podcasts-sort-select" class="sort-label">Sort:</label>
                            <select id="author-podcasts-sort-select" class="sort-select" onchange="applyAuthorPodcastsSorting()">
                                <option value="title-asc">A-Z</option>
                                <option value="title-desc">Z-A</option>
                            </select>
                        </div>
                    </div>
                    <div id="author-podcasts-grid" class="podcast-grid"></div>
                </div>
            </div>
        </div>

        <!-- Episode Detail Page -->
        <div id="page-episode" class="page hidden">
            <div class="page-header">
                <button class="btn-back" onclick="goBackFromEpisode()">‚Üê Back</button>
                <h1 id="episode-page-title">Episode</h1>
            </div>
            <div id="episode-detail-content" class="episode-detail-content"></div>
        </div>

        <!-- Search Page / All Episodes Page -->
        <div id="page-search" class="page hidden">
            <div class="page-header">
                <h1 id="search-page-title">Search</h1>
            </div>
            <div class="search-container">
                <div id="search-results" class="search-results">
                    <div class="empty"><p>Start typing in the search bar above...</p></div>
                </div>
            </div>
        </div>
        
        <!-- All Episodes Page -->
        <div id="page-all-episodes" class="page hidden">
            <div class="page-header">
                <h1>All Episodes</h1>
            </div>
            <div id="episodes-controls" class="podcast-controls">
                <div class="controls-left">
                    <div class="sort-controls">
                        <label for="episodes-sort-select" class="sort-label">Sort:</label>
                        <select id="episodes-sort-select" class="sort-select" onchange="applyEpisodesSorting()">
                            <option value="title-asc">A-Z</option>
                            <option value="title-desc">Z-A</option>
                            <option value="date-desc">Newest to Oldest</option>
                            <option value="date-asc">Oldest to Newest</option>
                        </select>
                    </div>
                    <div class="filter-controls">
                        <label for="episodes-duration-filter" class="filter-label">Episode Duration:</label>
                        <select id="episodes-duration-filter" class="filter-select" onchange="applyEpisodesDurationFilter()">
                            <option value="all">All Durations</option>
                            <option value="under10">Under 10 min</option>
                            <option value="10-30">10-30 min</option>
                            <option value="30-60">30-60 min</option>
                            <option value="60plus">60+ min</option>
                        </select>
                    </div>
                </div>
                <div class="controls-right">
                    <div id="episodes-count" class="podcast-count"></div>
                </div>
            </div>
            <div id="all-episodes-list" class="episodes-full-page"></div>
        </div>
    </main>

    <!-- Persistent Audio Player (always visible when playing) -->
    <div id="player-bar" class="player-bar hidden">
        <div class="player-bar-content">
            <div class="player-bar-left" onclick="navigateTo('episode')">
                <div class="player-bar-artwork">
                    <img id="player-bar-image" src="" alt="" onerror="this.style.display='none'">
                </div>
                <div class="player-bar-text">
                    <h3 id="player-bar-title">Now Playing</h3>
                    <p id="player-bar-episode">Select an episode</p>
                </div>
            </div>
            <div class="player-bar-center">
                <div class="player-bar-controls">
                    <button class="btn-skip-text-only" onclick="skipBackward()" title="Skip back 10s">
                        <span class="skip-number">-10</span>
                    </button>
                    <button id="play-pause-btn-bar" class="btn-play-pause-main" onclick="togglePlayPause()">
                        <span id="play-icon-bar">‚ñ∂</span>
                    </button>
                    <button class="btn-skip-text-only" onclick="skipForward()" title="Skip forward 30s">
                        <span class="skip-number">+30</span>
                    </button>
                </div>
                <div class="player-bar-progress-wrapper">
                    <div class="player-bar-time-left" id="current-time-bar">0:00</div>
                    <div class="player-bar-progress" id="player-bar-progress" onclick="seekToPosition(event)">
                        <div class="player-bar-progress-fill" id="player-bar-progress-fill"></div>
                    </div>
                    <div class="player-bar-time-right" id="duration-bar">0:00</div>
                </div>
            </div>
            <div class="player-bar-right"></div>
        </div>
        <audio id="audio-player" preload="none"></audio>
    </div>

    <!-- Auth Modal -->
    <div id="auth-modal" class="auth-modal hidden">
        <div class="auth-modal-overlay" onclick="closeAuthModal()"></div>
        <div class="auth-modal-content">
            <div class="auth-modal-header">
                <h2 id="auth-modal-title">Sign In</h2>
                <button class="btn-close-modal" onclick="closeAuthModal()">‚úï</button>
            </div>
            <div class="auth-modal-body">
                <div id="auth-error" class="auth-error hidden"></div>
                <div id="auth-success" class="auth-success hidden"></div>
                
                <div id="auth-signin-form" class="auth-form">
                    <div class="auth-form-group">
                        <label for="signin-email">Email</label>
                        <input type="email" id="signin-email" class="auth-input" placeholder="your@email.com">
                    </div>
                    <div class="auth-form-group">
                        <label for="signin-password">Password</label>
                        <input type="password" id="signin-password" class="auth-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                    </div>
                    <button class="btn-auth-primary" onclick="handleSignIn()">Sign In</button>
                    <p class="auth-switch-text">
                        Don't have an account? 
                        <a href="#" onclick="switchAuthMode('signup'); return false;">Sign up</a>
                    </p>
                </div>

                <div id="auth-signup-form" class="auth-form hidden">
                    <div class="auth-form-group">
                        <label for="signup-email">Email</label>
                        <input type="email" id="signup-email" class="auth-input" placeholder="your@email.com">
                    </div>
                    <div class="auth-form-group">
                        <label for="signup-password">Password</label>
                        <input type="password" id="signup-password" class="auth-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                    </div>
                    <div class="auth-form-group">
                        <label for="signup-password-confirm">Confirm Password</label>
                        <input type="password" id="signup-password-confirm" class="auth-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                    </div>
                    <button class="btn-auth-primary" onclick="handleSignUp()">Sign Up</button>
                    <p class="auth-switch-text">
                        Already have an account? 
                        <a href="#" onclick="switchAuthMode('signin'); return false;">Sign in</a>
                    </p>
                </div>

                <div id="auth-signedin" class="auth-signedin hidden">
                    <p>Signed in as <strong id="auth-user-email"></strong></p>
                    <p class="auth-sync-status" id="auth-sync-status">Syncing...</p>
                    <button class="btn-auth-secondary" onclick="handleSignOut()">Sign Out</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Supabase JS -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="/web/config.js"></script>
    <script src="/web/api.js"></script>
    <script src="/web/auth.js"></script>
    <script src="/web/app.js"></script>
    <!-- Vercel Analytics -->
    <script type="module">
        import { inject } from 'https://esm.sh/@vercel/analytics@1';
        inject();
    </script>
</body>
</html>
